
#--------------------------
# Variables
#--------------------------

 MAKE         = make -s
 CC           = @CC@
 SOURCE_PATH  = ./
 EXPAND_DIR   = @prefix@
 OBJECTS_MPISERVER     = mpiServer.o \
		                 mpiServer_params.o \
		                 mpiServer_comm.o \
		                 mpiServer_ops.o \
		                 mpiServer_workers.o \
		                 mpiServer_workers_ondemand.o \
		                 mpiServer_workers_pool.o \
		                 mpiServer_d2xpn.o \
			             base/filesystem.o \
			             base/urlstr.o \
			             base/string_misc.o \
			             base/debug_msg.o \
			             base/utils.o \
			             base/time_misc.o
MYFLAGS                = -g  -Wall -Wextra -static -std=c11 -D_REENTRANT -DPOSIX_THREADS -DHAVE_CONFIG_H -DLINUX -DXPNI_LOWFSI_XPN -D_GNU_SOURCE -DBUILD_LITE -DHAVE_STRUCT_IOVEC  -D_MALLOC_
MYHEADERS              =  -I. -I$(EXPAND_DIR)/include -I../../../xpn/include
MYLIBS                 =  -L../../../xpn/lib -L../../../mxml -lpthread -lxpn -lmxml -ldl

MPISERVER_EXE = xpn_mpiserver
MPISERVER_EXE_STOP = xpn_stop_mpiserver


#--------------------------
# Compilation rules
#--------------------------


all:  all_object  all_exe

all_object:  $(OBJECTS_MPISERVER)

all_exe:  $(MPISERVER_EXE) $(MPISERVER_EXE_STOP)

install:  $(MPISERVER_EXE)
	@cp -a $(MPISERVER_EXE) $(EXPAND_DIR)/bin

%.o: %.c
	$(CC) $(MYFLAGS) $(MYHEADERS) -c $< -o $@

$(MPISERVER_EXE): $(OBJECTS_MPISERVER)
	$(CC) -o $(MPISERVER_EXE)  $(OBJECTS_MPISERVER)  $(MYLIBS)

$(MPISERVER_EXE_STOP): $(MPISERVER_EXE)
	ln -s $(MPISERVER_EXE) $(MPISERVER_EXE_STOP)


clean:
	rm -f $(OBJECTS_MPISERVER)
	rm -f $(MPISERVER_EXE)
	rm -f $(MPISERVER_EXE_STOP)

